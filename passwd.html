<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九宫格密码生成器</title>
    <style>
        /* 基础重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 全屏容器，确保页面居中 */
        html, body {
            height: 100%;
            width: 100%;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center; /* 水平居中 */
            align-items: center;     /* 垂直居中 */
            padding: 15px; /* 避免边缘紧贴屏幕 */
        }

        /* 内容容器，自适应宽度 */
        .container {
            width: 100%;
            max-width: 500px; /* 最大宽度限制，避免在大屏上过宽 */
            background: white;
            padding: 5vw; /* 使用视窗宽度作为单位，自适应不同屏幕 */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* 时间显示 */
        .time {
            color: #666;
            margin-bottom: 3vw;
            font-size: 4vw; /* 相对字体大小 */
            text-align: center; /* 文字居中 */
        }

        /* 密码显示（核心内容放大突出） */
        .password {
            font-size: 10vw;
            font-weight: bold;
            color: #2c3e50;
            margin: 5vw 0;
            letter-spacing: 2px;
            text-align: center;
            padding: 2vw 0;
            border-bottom: 1px solid #eee;
        }

        /* 验证信息区域 */
        .verify {
            background: #f8f9fa;
            padding: 3vw;
            border-radius: 8px;
            font-size: 3.5vw;
            color: #34495e;
            line-height: 1.6; /* 行高优化，避免文字拥挤 */
            margin-bottom: 3vw;
        }

        /* 刷新提示信息 */
        .info-area {
            text-align: center;
            margin-top: 3vw;
        }

        .refresh-info {
            color: #7f8c8d;
            font-size: 3vw;
        }

        .refresh-indicator {
            color: #e74c3c;
            font-size: 3vw;
            margin-top: 2vw;
            min-height: 4vw; /* 避免提示消失时布局跳动 */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="time" id="currentTime"></div>
        <div class="password" id="password"></div>
        <div class="verify" id="verification"></div>
        <div class="info-area">
            <div class="refresh-info">密码随分钟变化自动刷新</div>
            <div class="refresh-indicator" id="refreshIndicator"></div>
        </div>
    </div>

    <script>
        // 九宫格坐标映射
        const posMap = {
            1: [0, 0], 2: [0, 1], 3: [0, 2],
            4: [1, 0], 5: [1, 1], 6: [1, 2],
            7: [2, 0], 8: [2, 1], 9: [2, 2]
        };

        // 检查连线合法性
        function isValidLine(a, b, used) {
            const [ax, ay] = posMap[a];
            const [bx, by] = posMap[b];
            const dx = Math.abs(ax - bx);
            const dy = Math.abs(ay - by);

            let mid = null;
            if (dx === 0 && dy === 2) mid = (a + b) / 2;       // 水平
            else if (dy === 0 && dx === 2) mid = (a + b) / 2;  // 垂直
            else if (dx === 2 && dy === 2) mid = (a + b) / 2;  // 对角线

            return mid === null || used.includes(mid);
        }

        // 获取当前时间（带秒数）
        function getCurrentTime() {
            const now = new Date();
            let hour = now.getHours();
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12 || 12; // 24小时制转12小时制（0→12）
            const minute = now.getMinutes();
            const second = now.getSeconds();

            return {
                timeStr: `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}:${second.toString().padStart(2, '0')} ${ampm}`,
                hour,
                minute,
                second
            };
        }

        // 生成密码（核心函数）
        function generatePassword() {
            const { timeStr, hour, minute } = getCurrentTime();
            
            // 1. 处理小时
            let h = hour;
            if (h === 10) h = 1;
            else if (h === 11) h = 2;
            else if (h === 12) h = 3;

            // 2. 处理分钟十位
            let mTen = Math.floor(minute / 10) + 4;
            const usedH = [h];
            while (mTen === h || !isValidLine(h, mTen, usedH)) {
                mTen = mTen >= 9 ? 1 : mTen + 1;
            }

            // 3. 处理分钟个位
            let mUnit = minute % 10 || 1; // 0→1
            const usedHM = [...usedH, mTen];
            while (mUnit === h || mUnit === mTen || !isValidLine(mTen, mUnit, usedHM)) {
                mUnit = mUnit >= 9 ? 1 : mUnit + 1;
            }

            // 4. 处理上下午
            let aNum = 1;
            const usedAll = [...usedHM, mUnit];
            while (usedAll.includes(aNum) || !isValidLine(mUnit, aNum, usedAll)) {
                aNum = aNum >= 9 ? 1 : aNum + 1;
            }

            // 5. 计算校验位
            const sum = h + mTen + mUnit + aNum;
            let checkBit = sum % 9 || 9; // 0→9
            const usedAll4 = [...usedAll, aNum];
            while (usedAll4.includes(checkBit) || !isValidLine(aNum, checkBit, usedAll4)) {
                checkBit = checkBit >= 9 ? 1 : checkBit + 1;
            }

            // 更新界面
            const password = `${h}${mTen}${mUnit}${aNum}${checkBit}`;
            document.getElementById('currentTime').textContent = `当前时间：${timeStr}`;
            document.getElementById('password').textContent = password;
            document.getElementById('verification').innerHTML = `
                路径验证：<br>
                - ${h}→${mTen}：${isValidLine(h, mTen, usedH) ? '合法' : '不合法'}<br>
                - ${mTen}→${mUnit}：${isValidLine(mTen, mUnit, usedHM) ? '合法' : '不合法'}<br>
                - ${mUnit}→${aNum}：${isValidLine(mUnit, aNum, usedAll) ? '合法' : '不合法'}<br>
                - ${aNum}→${checkBit}：${isValidLine(aNum, checkBit, usedAll4) ? '合法' : '不合法'}
            `;

            return minute;
        }

        // 初始化：首次加载不显示更新提示
        let lastMinute = generatePassword();
        document.getElementById('refreshIndicator').textContent = ''; // 首次加载清空提示

        // 实时更新逻辑
        setInterval(() => {
            const { timeStr, minute, second } = getCurrentTime();
            document.getElementById('currentTime').textContent = `当前时间：${timeStr}`;
            
            if (minute !== lastMinute) {
                lastMinute = generatePassword();
                document.getElementById('refreshIndicator').textContent = '分钟变化，密码已更新';
                setTimeout(() => {
                    document.getElementById('refreshIndicator').textContent = '';
                }, 3000);
            } else if (second === 0) {
                lastMinute = generatePassword();
            }
        }, 1000);
    </script>
</body>
</html>
